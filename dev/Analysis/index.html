<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Analysis · ReactionMechanismSimulator.jl</title><meta name="title" content="Analysis · ReactionMechanismSimulator.jl"/><meta property="og:title" content="Analysis · ReactionMechanismSimulator.jl"/><meta property="twitter:title" content="Analysis · ReactionMechanismSimulator.jl"/><meta name="description" content="Documentation for ReactionMechanismSimulator.jl."/><meta property="og:description" content="Documentation for ReactionMechanismSimulator.jl."/><meta property="twitter:description" content="Documentation for ReactionMechanismSimulator.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.png" alt="ReactionMechanismSimulator.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">ReactionMechanismSimulator.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../Input/">Input</a></li><li><a class="tocitem" href="../Simulating/">Simulations</a></li><li class="is-active"><a class="tocitem" href>Analysis</a><ul class="internal"><li><a class="tocitem" href="#The-Simulation-Object"><span>The Simulation Object</span></a></li><li><a class="tocitem" href="#The-SystemSimulation-Object"><span>The SystemSimulation Object</span></a></li><li><a class="tocitem" href="#Useful-Properties"><span>Useful Properties</span></a></li><li><a class="tocitem" href="#Plotting"><span>Plotting</span></a></li><li><a class="tocitem" href="#Flux-Diagrams"><span>Flux Diagrams</span></a></li><li><a class="tocitem" href="#Other-Useful-Functionality"><span>Other Useful Functionality</span></a></li></ul></li><li><a class="tocitem" href="../AutomaticMechanismAnalysis/">Automatic Mechanism Analysis</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Analysis</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Analysis</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/ReactionMechanismGenerator/ReactionMechanismSimulator.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/ReactionMechanismGenerator/ReactionMechanismSimulator.jl/blob/main/docs/src/Analysis.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Analysis"><a class="docs-heading-anchor" href="#Analysis">Analysis</a><a id="Analysis-1"></a><a class="docs-heading-anchor-permalink" href="#Analysis" title="Permalink"></a></h1><h2 id="The-Simulation-Object"><a class="docs-heading-anchor" href="#The-Simulation-Object">The Simulation Object</a><a id="The-Simulation-Object-1"></a><a class="docs-heading-anchor-permalink" href="#The-Simulation-Object" title="Permalink"></a></h2><p>Since the solver interface is exposed the solution object generated only gives the raw moles and raw sensitivity values, which typically are not what a user wants.  The Simulation object combines the solution information and the domain information to calculate much more useful properties of the solution.  </p><p>The Simulation object can be defined:  </p><pre><code class="nohighlight hljs">bsol = Simulation(sol,domain,interfaces,p)</code></pre><p>where <code>sol</code> is the ODESolution object output by the DifferentialEquations package, <code>domain</code> is the domain <code>sol</code> corresponds to, interfaces is the array of interface objects and p is the parameter vector.</p><h2 id="The-SystemSimulation-Object"><a class="docs-heading-anchor" href="#The-SystemSimulation-Object">The SystemSimulation Object</a><a id="The-SystemSimulation-Object-1"></a><a class="docs-heading-anchor-permalink" href="#The-SystemSimulation-Object" title="Permalink"></a></h2><p>When a system involves multiple domains a single Simulation object is insufficient. For these systems you need to construct a SystemSimulation object. This works in much the same way except that the domains should be listed as a tuple and the domain and interface ordering should be the same as that used when constructing the Reactor object. In theory the SystemSimulation object should be able to be used in place of a Simulation object in most places (If this is not the case and should be the case please make an issue!).</p><pre><code class="nohighlight hljs">ssys = SystemSimulation(sol,(domainliq,domaincat,),interfaces,p);</code></pre><h2 id="Useful-Properties"><a class="docs-heading-anchor" href="#Useful-Properties">Useful Properties</a><a id="Useful-Properties-1"></a><a class="docs-heading-anchor-permalink" href="#Useful-Properties" title="Permalink"></a></h2><h3 id="Thermodynamic-Properties"><a class="docs-heading-anchor" href="#Thermodynamic-Properties">Thermodynamic Properties</a><a id="Thermodynamic-Properties-1"></a><a class="docs-heading-anchor-permalink" href="#Thermodynamic-Properties" title="Permalink"></a></h3><p>Any thermodynamic property (T,P,V,C) at any given time <code>t</code> can be calculated in the format</p><pre><code class="nohighlight hljs">getT(bsol,t)</code></pre><p>where T can be replaced by any of the other properties.  </p><h3 id="Mole-Fractions"><a class="docs-heading-anchor" href="#Mole-Fractions">Mole Fractions</a><a id="Mole-Fractions-1"></a><a class="docs-heading-anchor-permalink" href="#Mole-Fractions" title="Permalink"></a></h3><p>Mole fraction information can be retrieved using the <code>molefraction</code> function.   <code>molefraction(bsol)</code> will give the mole fractions of all species at the times <code>bsol.sol.t</code>.   <code>molefraction(bsol,t)</code> will the mole fractions of all species at time <code>t</code>.   <code>molefraction(bsol,name,t)</code> will give the mole fraction of the species with name <code>name</code> at time <code>t</code>.  </p><h3 id="ROPs"><a class="docs-heading-anchor" href="#ROPs">ROPs</a><a id="ROPs-1"></a><a class="docs-heading-anchor-permalink" href="#ROPs" title="Permalink"></a></h3><p>Rates of production/consumption (associated with each reaction and each species at a given time) can be retrived using the <code>rops</code> function.   <code>rops(bsol,t)</code> will the matrix of rops for all species and all reactions at time <code>t</code>.   <code>rops(bsol,name,t)</code> will give the array of rops for the species with name <code>name</code> at time <code>t</code>.  </p><h3 id="Concentration-Sensitivities"><a class="docs-heading-anchor" href="#Concentration-Sensitivities">Concentration Sensitivities</a><a id="Concentration-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Concentration-Sensitivities" title="Permalink"></a></h3><p>Concentration sensitivities to rate coefficients and species gibbs free energies can be retrieved using the <code>getconcentrationsensitivity(bsol,numerator,denominator,t)</code> function.   Here <code>bsol</code> denotes the Simulation object, and <code>t</code> denotes the time.  The output is the sensitivity of the <code>numerator</code> to the <code>denominator</code>.  For species concentration and species thermo this is the name of the species for reactions this is the index of the reaction.  </p><h3 id="Rates"><a class="docs-heading-anchor" href="#Rates">Rates</a><a id="Rates-1"></a><a class="docs-heading-anchor-permalink" href="#Rates" title="Permalink"></a></h3><p>The function <code>rates</code> can be used to calculate the rates of all reactions at specific time points.   <code>rates(bsol,t)</code> will give the array of reaction rates at time <code>t</code> while <code>rates(bsol;ts=ts)</code> will give a matrix of reaction rates at all times in <code>ts</code>.   Note that <code>ts</code> defaults to <code>bsol.sol.t</code>.  </p><h3 id="Adjoint-Sensitivities"><a class="docs-heading-anchor" href="#Adjoint-Sensitivities">Adjoint Sensitivities</a><a id="Adjoint-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Adjoint-Sensitivities" title="Permalink"></a></h3><p>Sensitivity values to a target species or thermodynamic variable can be computed from a <code>Simulation</code> or <code>SystemSimulation</code> object using the <code>getadjointsensitivities(bsol::Q,target::String,solver::W;sensalg::W2=InterpolatingAdjoint(autojacvec=ReverseDiffVJP(false)),abstol::Float64=1e-6,reltol::Float64=1e-3,normalize=true,kwargs...)</code> function. This computes the sensitivity with respect to the target at the final time point of bsol. It uses <code>solver</code>, <code>sensalg</code>, <code>abstol</code>, and <code>reltol</code> for the adjoint solve and by default will give the normalized sensitivity values (note these are molar sensitivities, concentration sensitivities can&#39;t be computed from a single adjoint pass). This is usually much faster than forward sensitivities.</p><h3 id="Transitory-Sensitivities"><a class="docs-heading-anchor" href="#Transitory-Sensitivities">Transitory Sensitivities</a><a id="Transitory-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Transitory-Sensitivities" title="Permalink"></a></h3><p>Transitory sensitivity values can be computed using several different algorithms. <code>transitorysensitivitiesfullexact(sim::Simulation,t;tau=NaN,         normalized=true,solver=Sundials.CVODE_BDF(linear_solver=:GMRES),         abstol=1e-16,reltol=1e-6)</code> gives you the exact full matrix of transitory sensitivities using the forward sensitivity algorithm, while <code>transitorysensitivitiesfulltrapezoidal(sim,t;tau=NaN,normalized=true)</code> gives the approximate full matrix of transitory sensitivities using the trapezoidal method. <code>transitorysensitivitiesparamexact</code> and <code>transitorysensitivitiesparamtrapezoidal</code> are available for computing a single column of the matrix (with respect to a single parameter)). Lastly <code>transitorysensitivitiesadjointexact(sim::Simulation,t,name;tau=NaN,         normalized=true,solver=Sundials.CVODE_BDF(),sensalg=InterpolatingAdjoint(),         abstol=1e-16,reltol=1e-6)</code> is available for computing a single row of the matrix (sensitivity to a specified species with respect to all parameters). The adjoint algorithm is jacobian free if <code>tau</code> is specified and the solver is jacobian free. </p><h3 id="Other-Useful-Properties"><a class="docs-heading-anchor" href="#Other-Useful-Properties">Other Useful Properties</a><a id="Other-Useful-Properties-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Useful-Properties" title="Permalink"></a></h3><p>Please let us know on our Github issues page if we&#39;re missing any important property calculators.  </p><h2 id="Plotting"><a class="docs-heading-anchor" href="#Plotting">Plotting</a><a id="Plotting-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting" title="Permalink"></a></h2><h3 id="Plotting-Mole-Fractions"><a class="docs-heading-anchor" href="#Plotting-Mole-Fractions">Plotting Mole Fractions</a><a id="Plotting-Mole-Fractions-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Mole-Fractions" title="Permalink"></a></h3><p>Mole fractions can be plotting using the <code>plotmolefractions</code> function <code>plotmolefractions(bsol, tf; t0=1e-15,N=1000,tol=0.01)</code> plots all species with molefraction greater than <code>tol</code> at <code>N</code> logarithmically spaced time points between <code>t0</code> and <code>tf</code>.   <code>plotmolefractions(bsol; tol=0.01)</code> plots all species with molefraction greater than <code>tol</code> at the points in <code>bsol.sol.t</code>.   <code>plotmolefractions(bsol,spcnames)</code> plots all the species with names in <code>spcnames</code> at the points in <code>bsol.sol.t</code>.  </p><h3 id="Plotting-Forward-Sensitivities"><a class="docs-heading-anchor" href="#Plotting-Forward-Sensitivities">Plotting Forward Sensitivities</a><a id="Plotting-Forward-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Forward-Sensitivities" title="Permalink"></a></h3><p>Sensitivities (normalized molar sensitivities) can be plotted using the <code>plotmaxthermoforwardsensitivity</code> and <code>plotmaxrateforwardsensitivity</code> functions.   Both of these follow the same format:   <code>plotmaxthermoforwardsensitivity(bsol, spcname; N=0, tol= 1e-2)</code> <code>spcname</code> corresponds to the species sensitivities are being calculated for, <code>N</code> is the maximum number of sensitive species/reactions plotted (0 corresponds to all of them), sensitive species/reactions with sensitivities less than <code>tol</code> are not included in the plot.  Note that the thermo sensitivities are given in mol/kcal while the rate sensitivities are fully non-dimensionalized (as displayed on the plots).  </p><h3 id="Plotting-Adjoint-Sensitivities"><a class="docs-heading-anchor" href="#Plotting-Adjoint-Sensitivities">Plotting Adjoint Sensitivities</a><a id="Plotting-Adjoint-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Adjoint-Sensitivities" title="Permalink"></a></h3><p>Adjoint sensitivities can be plotted using the <code>plotthermoadjointsensitivities(bsol::Y,name::X,dps::Z;N=0,tol=0.01)</code> and <code>plotrateadjointsensitivities(bsol::Y,name::X,dps::Z;N=0,tol=0.01)</code> functions where <code>dps</code> is the normalized adjoint sensitivity values.</p><h3 id="Plotting-ROPs"><a class="docs-heading-anchor" href="#Plotting-ROPs">Plotting ROPs</a><a id="Plotting-ROPs-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-ROPs" title="Permalink"></a></h3><p>ROPs can be plotted with the <code>plotrops</code> function.   <code>plotrops(bsol,name,t;N=0,tol=0.01)</code> will plot the ROPs for species with name <code>name</code> at time <code>t</code> including at most <code>N</code> reactions and not including reactions with absolute rates less than tol * the largest absolute rate.  This is a bar plot comparing the reactions that contribute the most to the production and loss of the species</p><p>The rops can be plotted with respect to time on a line plot using <code>plotrops(bsol,name;rxnrates=Array{Float64,1}(),ts=Array{Float64,1}(),tol=0.05)</code> in this case <code>rxnrates</code> corresponds to the matrix of reaction rates at each time point (can be expensive to compute so if available can be reused), <code>ts</code> correpsonds to a set of time points to plot at (otherwise defaults to <code>bsol.sol.t</code>), any reaction with flux smaller than <code>tol</code> * the largest absolute rate at every time point is excluded from the plot.  </p><p>The analogous functions <code>plotradicalrops(bsol,t;N=0,tol=0.01)</code> and <code>plotradicalrops(bsol;rxnrates=Array{Float64,1}(),ts=Array{Float64,1}(),tol=0.05)</code> are available for plotting the rops for the sum of all radicals.</p><h3 id="Plotting-Transitory-Sensitivities"><a class="docs-heading-anchor" href="#Plotting-Transitory-Sensitivities">Plotting Transitory Sensitivities</a><a id="Plotting-Transitory-Sensitivities-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Transitory-Sensitivities" title="Permalink"></a></h3><p>Transitory sensitivities and be combusted and plotted using <code>plotrxntransitorysensitivities(bsol,name,t;dSdt=nothing,tau=nothing,tol=1e-3,N=0,rxntol=1e-6)</code> and <code>plotthermotransitorysensitivities(bsol,name,t;dSdt=nothing,tau=nothing,tol=1e-3,N=0)</code> where dSdt contains the transitory sensitivity values otherwise these values will be computed automatically using the trapezoidal method using the input <code>tau</code> or automatically selecting <code>tau</code> and the <code>rxntol</code> value. At most <code>N</code> reactions are included in the plot and the plot will not include reactions with absolute transitory sensitivities less than <code>tol</code> times the largest absolute value.</p><h3 id="Plotting-Time-Scales"><a class="docs-heading-anchor" href="#Plotting-Time-Scales">Plotting Time Scales</a><a id="Plotting-Time-Scales-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-Time-Scales" title="Permalink"></a></h3><p>The timescale distribution of a simulation at a point can be plotted using <code>plottimescales(sim,t;taumax=1e6,taumin=1e-18,taures=10.0^0.5,usediag=true)</code> or <code>plottimescales(Jy;taumax=1e6,taumin=1e-18,taures=10.0^0.5,usediag=true)</code> where <code>taumax</code>, <code>taumin</code> and <code>taures</code> control the bins. If <code>usediag=true</code> it will simply determine the timescales using the diagonal of the Jacobian otherwise it will compute and use the eigenvalues. In general we&#39;ve observed no significant differences in distributions generated using the diagonal values vs the eigenvalues although there may be significant differences when the mechanism is small.</p><h3 id="Other-Plots"><a class="docs-heading-anchor" href="#Other-Plots">Other Plots</a><a id="Other-Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Plots" title="Permalink"></a></h3><p>While we are trying to build up a library of plotting functions that make mechanism analysis easier we may not have the one you need.  However, the tools in the Useful Properties section should be enough most of the time. We&#39;re happy to provide guidance on our Github issues page and add plotting functions you find useful.  </p><h2 id="Flux-Diagrams"><a class="docs-heading-anchor" href="#Flux-Diagrams">Flux Diagrams</a><a id="Flux-Diagrams-1"></a><a class="docs-heading-anchor-permalink" href="#Flux-Diagrams" title="Permalink"></a></h2><p>RMS generates flux diagrams with molecular images (or names when images aren&#39;t available) using the <code>getfluxdiagram</code> function:  </p><pre><code class="nohighlight hljs">getfluxdiagram(bsol,t;centralspecieslist=Array{String,1}(),superimpose=false,
    maximumnodecount=50, maximumedgecount=50, concentrationtol=1e-6, speciesratetolerance=1e-6,
    maximumnodepenwidth=10.0,maximumedgepenwidth=10.0,radius=1,centralreactioncount=-1,outputdirectory=&quot;fluxdiagrams&quot;)</code></pre><p>This generates a flux diagram at the time point <code>t</code>.  <code>centralspecieslist</code> denotes a list of species that must be included in the diagram, <code>maximumnodecount</code> denotes the maximum number of species in the diagram, <code>maximumedgecount</code> denotes the maximum number of connections between species, <code>concentrationtol</code> denotes the lowest fractional concentration to show in the diagram, <code>speciesratetolerance</code> denotes the lowest fraction species rate to show in the diagram, <code>maximumNodePenWidth</code> denotes the thickness of the border around a node a maximum concentration.  <code>maximumedgepenwidth</code> denotes the thickness of the edge at maximum species rate, <code>radius</code> is the graph radius plotted around a central species.  </p><h2 id="Other-Useful-Functionality"><a class="docs-heading-anchor" href="#Other-Useful-Functionality">Other Useful Functionality</a><a id="Other-Useful-Functionality-1"></a><a class="docs-heading-anchor-permalink" href="#Other-Useful-Functionality" title="Permalink"></a></h2><p><code>spcindex(bsol,name)</code> will give you the index of the species with name <code>name</code>.  </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Simulating/">« Simulations</a><a class="docs-footer-nextpage" href="../AutomaticMechanismAnalysis/">Automatic Mechanism Analysis »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.1 on <span class="colophon-date" title="Sunday 18 February 2024 02:12">Sunday 18 February 2024</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
